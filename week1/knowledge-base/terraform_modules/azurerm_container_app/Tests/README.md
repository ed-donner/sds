# Infra Team Test

This module test is used to create an Azure Container App service and is for testing purposes only.

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) | 2.2.0 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | 4.20.0 |

## Providers

No providers.

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_axso_container_apps"></a> [axso\_container\_apps](#module\_axso\_container\_apps) | git::ssh://git@ssh.dev.azure.com/v3/Axpo-AXSO/TIM-INFRA-MODULES/azurerm_container_app | ~{gitRef}~ |

## Resources

No resources.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_acr_umid_name"></a> [acr\_umid\_name](#input\_acr\_umid\_name) | The name of the user managed identity that has access to the container registry | `string` | `null` | no |
| <a name="input_acr_umid_resource_group"></a> [acr\_umid\_resource\_group](#input\_acr\_umid\_resource\_group) | The name for the resource group where the managed identity is located | `string` | `null` | no |
| <a name="input_ca_umids"></a> [ca\_umids](#input\_ca\_umids) | values for the user managed identities | <pre>map(object({<br/>    umid_name    = string<br/>    umid_rg_name = string<br/>  }))</pre> | n/a | yes |
| <a name="input_container_app_configs"></a> [container\_app\_configs](#input\_container\_app\_configs) | Container App configurations | <pre>map(object({<br/>    usecase = string<br/><br/>    # Infrastructure Subnet Configurations<br/>    infra_subnet_configs = object({<br/>      infra_subnet_name    = string<br/>      infra_vnet_name      = string<br/>      infra_subnet_rg_name = string<br/>    })<br/><br/>    # Container App Environment- workload profile<br/>    cae_workload_profiles = map(object({<br/>      name                  = string<br/>      workload_profile_type = string<br/>      maximum_count         = number<br/>      minimum_count         = number<br/>    }))<br/><br/>    cae_custom_certificates = map(object({<br/>      key_vault_name                = string<br/>      keyvault_certificate_name     = string<br/>      cae_certificate_friendly_name = string<br/>    }))<br/><br/>    ca_custom_domains = map(object({<br/>      ca_name                       = string<br/>      cae_certificate_friendly_name = string<br/>      ca_custom_domain_name         = string<br/>    }))<br/><br/>    log_analytics_workspace_name = string<br/><br/>    # Container App Environment - Storage Configurations<br/>    cae_storage_configs = map(object({<br/>      storage_config_name     = string<br/>      storage_account_name    = string<br/>      storage_account_rg_name = string<br/>      share_name              = string<br/>      access_mode             = string<br/>    }))<br/><br/>    # Container Apps<br/>    container_apps = map(object({<br/>      name                  = string<br/>      revision_mode         = string<br/>      workload_profile_name = string<br/>      identity_type         = string<br/><br/>      template = object({<br/>        containers = list(object({<br/>          name   = string<br/>          image  = string<br/>          cpu    = number<br/>          memory = string<br/>          args   = list(string)<br/>          volume_mounts = list(object({<br/>            name = string<br/>            path = string<br/>          }))<br/>          env = list(object({<br/>            name        = string<br/>            secret_name = optional(string)<br/>            value       = optional(string)<br/>          }))<br/>          startup_probe = optional(object({<br/>            failure_count_threshold = optional(number, 3)<br/>            header = optional(object({<br/>              name  = string<br/>              value = number<br/>            }), null)<br/>            host                             = optional(string, null)<br/>            interval_seconds                 = optional(number, 10)<br/>            path                             = optional(string, "/")<br/>            port                             = number<br/>            termination_grace_period_seconds = optional(number)<br/>            timeout                          = optional(number, 1)<br/>            transport                        = string<br/>          }), null)<br/>          liveness_probe = optional(object({<br/>            failure_count_threshold = optional(number, 3)<br/>            header = optional(object({<br/>              name  = string<br/>              value = number<br/>            }), null)<br/>            host                             = optional(string, null)<br/>            initial_delay_seconds            = optional(number, 10)<br/>            interval_seconds                 = optional(number, 10)<br/>            path                             = optional(string, "/")<br/>            port                             = number<br/>            termination_grace_period_seconds = optional(number)<br/>            timeout                          = optional(number, 1)<br/>            transport                        = string<br/>          }), null)<br/><br/>          readiness_probe = optional(object({<br/>            failure_count_threshold = optional(number, 3)<br/>            header = optional(object({<br/>              name  = string<br/>              value = number<br/>            }), null)<br/>            host                    = optional(string, null)<br/>            interval_seconds        = optional(number, 10)<br/>            path                    = optional(string, null)<br/>            port                    = number<br/>            success_count_threshold = optional(number, 3)<br/>            timeout                 = optional(number, 1)<br/>            transport               = string<br/>          }), null)<br/><br/>        }))<br/>        min_replicas    = number<br/>        max_replicas    = number<br/>        revision_suffix = optional(string, null)<br/><br/>        azure_queue_scale_rules = optional(list(object({<br/>          name         = string<br/>          queue_name   = string<br/>          queue_length = number<br/>          authentication = object({<br/>            trigger_parameter = string<br/>            secret_name       = string<br/>          })<br/>        })))<br/><br/>        tcp_scale_rules = optional(list(object({<br/>          name                = string<br/>          concurrent_requests = string<br/>          authentication = optional(object({<br/>            trigger_parameter = string<br/>            secret_name       = string<br/>          }))<br/>        })), null)<br/><br/>        http_scale_rules = optional(list(object({<br/>          name                = string<br/>          concurrent_requests = string<br/>          authentication = optional(object({<br/>            trigger_parameter = string<br/>            secret_name       = string<br/>          }))<br/>        })), null)<br/><br/>        volume = object({<br/>          name         = string<br/>          storage_name = string<br/>          storage_type = string<br/>        })<br/>      })<br/><br/>      secrets = optional(list(object({<br/>        name                = string<br/>        identity_type       = optional(string, null)<br/>        umid_name           = optional(string, null)<br/>        key_vault_secret_id = optional(string, null)<br/>        value               = optional(string, null)<br/><br/>      })), [])<br/><br/>      ingress = object({<br/>        allow_insecure_connections = bool<br/>        external_enabled           = bool<br/>        target_port                = number<br/>        exposed_port               = optional(number, null)<br/>        transport                  = string<br/><br/>        ip_security_restriction = list(object({<br/>          name             = string<br/>          ip_address_range = string<br/>          action           = string<br/>        }))<br/><br/>        traffic_weight = optional(list(object({<br/>          label           = optional(string)<br/>          latest_revision = optional(bool)<br/>          revision_suffix = optional(string)<br/>          percentage      = number<br/>        })))<br/><br/>      })<br/><br/>    }))<br/><br/>    container_apps_jobs = map(object({<br/>      name                       = string<br/>      replica_timeout_in_seconds = number<br/>      replica_retry_limit        = number<br/>      workload_profile_name      = string<br/>      identity_type              = string<br/><br/>      manual_trigger_config = optional(object({<br/>        parallelism              = number<br/>        replica_completion_count = number<br/>      }), null)<br/><br/>      schedule_trigger_config = optional(object({<br/>        cron_expression          = string<br/>        parallelism              = number<br/>        replica_completion_count = number<br/>      }), null)<br/><br/>      event_trigger_config = optional(object({<br/>        parallelism              = number<br/>        replica_completion_count = number<br/>        scale = object({<br/>          max_executions              = number<br/>          min_executions              = number<br/>          polling_interval_in_seconds = number<br/>          rules = object({<br/>            name             = string<br/>            custom_rule_type = string<br/>            metadata         = map(string)<br/>            authentication = optional(list(object({<br/>              secret_name       = string<br/>              trigger_parameter = string<br/>            })), null)<br/>          })<br/>        })<br/>      }), null)<br/><br/>      template = object({<br/>        containers = list(object({<br/>          name   = string<br/>          image  = string<br/>          cpu    = number<br/>          memory = string<br/>          args   = list(string)<br/>          volume_mounts = list(object({<br/>            name = string<br/>            path = string<br/>          }))<br/>          env = list(object({<br/>            name        = string<br/>            secret_name = optional(string)<br/>            value       = optional(string)<br/>          }))<br/>          startup_probe = optional(object({<br/>            failure_count_threshold = optional(number, 3)<br/>            header = optional(object({<br/>              name  = string<br/>              value = number<br/>            }), null)<br/>            host                             = optional(string, null)<br/>            interval_seconds                 = optional(number, 10)<br/>            path                             = optional(string, "/")<br/>            port                             = number<br/>            termination_grace_period_seconds = optional(number)<br/>            timeout                          = optional(number, 1)<br/>            transport                        = string<br/>          }), null)<br/>          liveness_probe = optional(object({<br/>            failure_count_threshold = optional(number, 3)<br/>            header = optional(object({<br/>              name  = string<br/>              value = number<br/>            }), null)<br/>            host                             = optional(string, null)<br/>            initial_delay_seconds            = optional(number, 10)<br/>            interval_seconds                 = optional(number, 10)<br/>            path                             = optional(string, "/")<br/>            port                             = number<br/>            termination_grace_period_seconds = optional(number)<br/>            timeout                          = optional(number, 1)<br/>            transport                        = string<br/>          }), null)<br/><br/>          readiness_probe = optional(object({<br/>            failure_count_threshold = optional(number, 3)<br/>            header = optional(object({<br/>              name  = string<br/>              value = number<br/>            }), null)<br/>            host                    = optional(string, null)<br/>            interval_seconds        = optional(number, 10)<br/>            path                    = optional(string, null)<br/>            port                    = number<br/>            success_count_threshold = optional(number, 3)<br/>            timeout                 = optional(number, 1)<br/>            transport               = string<br/>          }), null)<br/><br/>        }))<br/><br/>        volume = object({<br/>          name         = string<br/>          storage_name = string<br/>          storage_type = string<br/>        })<br/>      })<br/><br/>      secrets = optional(list(object({<br/>        name                = string<br/>        identity_type       = optional(string, null)<br/>        umid_name           = optional(string, null)<br/>        key_vault_secret_id = optional(string, null)<br/>        value               = optional(string, null)<br/><br/>      })), [])<br/>    }))<br/><br/>  }))</pre> | n/a | yes |
| <a name="input_container_registry_server"></a> [container\_registry\_server](#input\_container\_registry\_server) | The name of the container registry server to connect to | `string` | `null` | no |
| <a name="input_dns_zone_name"></a> [dns\_zone\_name](#input\_dns\_zone\_name) | The domain name for the custom domain dns zone. | `string` | `"cloudinfra.axpo.cloud"` | no |
| <a name="input_environment"></a> [environment](#input\_environment) | The environment. e.g. dev, qa, uat, prod | `string` | `"dev"` | no |
| <a name="input_key_vault_name"></a> [key\_vault\_name](#input\_key\_vault\_name) | The name of the key vault to use for the secrets | `string` | n/a | yes |
| <a name="input_location"></a> [location](#input\_location) | (Required) Specifies the supported Azure location where the Container App Environment is to exist. Changing this forces a new resource to be created. | `string` | n/a | yes |
| <a name="input_project_name"></a> [project\_name](#input\_project\_name) | The name of the project. e.g. MDS | `string` | `"prj"` | no |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | (Required) The name of the resource group in which the Container App Environment is to be created. Changing this forces a new resource to be created. | `string` | n/a | yes |
| <a name="input_subscription"></a> [subscription](#input\_subscription) | The subscription type e.g. 'p' for prod or 'np' for nonprod | `string` | `"np"` | no |

## Outputs

No outputs.
<!-- END_TF_DOCS -->